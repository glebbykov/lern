
# Лабораторная работа №8: Расширенные функции Docker Swarm

## Цели работы
1. Изучить взаимодействие узлов в кластере Docker Swarm.
2. Освоить управление сетью и томами в Swarm.
3. Научиться использовать политики размещения для задач.
4. Исследовать работу с зашифрованными секретами в Docker Swarm.

---

## 1. Теоретическая часть
### Управление узлами в Docker Swarm
- **Типы узлов:**
  - Manager — управляет кластером.
  - Worker — выполняет задачи.
- **Добавление узлов в кластер:**
  - `docker swarm join-token` — получение токена для присоединения.
  - `docker swarm join` — добавление нового узла.

### Сети в Docker Swarm
- **Виды сетей:**
  - `overlay` — межузловые сети.
  - `ingress` — балансировка входящего трафика.
- **Создание пользовательских сетей:**
  - Команда `docker network create`.

### Политики размещения задач
- **Настройка политики:**
  - Использование параметра `--constraint` для задания ограничений размещения задач.

### Секреты в Docker Swarm
- **Создание и управление секретами:**
  - `docker secret create` — создание секрета.
  - `docker secret inspect` — просмотр информации о секрете.
- **Использование секретов в сервисах:**
  - Настройка секции `secrets` в `docker service create`.

---

## 2. Практическая часть
### Управление узлами
1. Инициализируйте режим Swarm, если он не активен:
    ```bash
    docker swarm init
    ```

2. Получите токен для подключения нового узла:
    ```bash
    docker swarm join-token worker
    ```

3. Добавьте новый узел в кластер (на втором хосте).

4. Проверьте список узлов:
    ```bash
    docker node ls
    ```

### Работа с сетью
1. Создайте пользовательскую сеть:
    ```bash
    docker network create --driver overlay my-overlay
    ```

2. Запустите сервисы в созданной сети:
    ```bash
    docker service create --name web --network my-overlay -p 8080:80 nginx
    docker service create --name db --network my-overlay mysql:5.7
    ```

3. Проверьте взаимодействие контейнеров через сеть.

### Политики размещения
1. Создайте сервис с ограничением размещения только на Worker-узлах:
    ```bash
    docker service create --name worker-service --constraint node.role==worker nginx
    ```

2. Проверьте, где размещены задачи:
    ```bash
    docker service ps worker-service
    ```

### Работа с секретами
1. Создайте секрет для использования в сервисе:
    ```bash
    echo "super_secret_password" | docker secret create db_password -
    ```

2. Создайте сервис с подключением секрета:
    ```bash
    docker service create --name db-secure --secret db_password mysql:5.7
    ```

3. Проверьте, что секрет доступен только внутри контейнера.

---

## 3. Теоретические вопросы
1. Чем отличаются типы узлов Manager и Worker в Docker Swarm?
2. Какие типы сетей поддерживает Docker Swarm?
3. Как использовать политики размещения для управления задачами?
4. Какие ограничения накладываются на секреты в Docker Swarm?
5. Как проверить текущее состояние кластера и его узлов?

---

## 4. Дополнительные задания
1. **Межузловое взаимодействие:**
   - Настройте взаимодействие двух сервисов, расположенных на разных узлах, через сеть `overlay`.

2. **Ограничения размещения:**
   - Создайте сервис с ограничением размещения только на определенных узлах (по имени или метке).

3. **Ротация секретов:**
   - Замените существующий секрет на новый без остановки сервиса.

4. **Мониторинг состояния:**
   - Используйте `docker node update` для временной деактивации узла и проверьте переназначение задач.

