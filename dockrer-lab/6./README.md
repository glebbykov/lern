
# Лабораторная работа №6: Обновление и масштабирование сервисов в Docker Swarm

## Цели работы
1. Изучить основы обновления и масштабирования сервисов в Docker Swarm.
2. Освоить применение стратегий обновления для сервисов.
3. Понять, как управлять репликами сервисов.
4. Ознакомиться с командами управления состоянием сервисов в Swarm.

---

## 1. Теоретическая часть
### Docker Swarm
- **Что такое Docker Swarm?**
  - Оркестрационная платформа для управления кластерами Docker.

### Обновление сервисов
- **Режим обновления:**
  - Поэтапное обновление задач (контейнеров) в сервисе.
- **Стратегии обновления:**
  - `--update-parallelism`: количество обновляемых задач одновременно.
  - `--update-delay`: задержка между обновлениями.

### Масштабирование сервисов
- **Реплики:**
  - Число экземпляров (контейнеров), запускаемых для одного сервиса.
  - Масштабирование с помощью `docker service scale`.

### Команды для управления сервисами
- `docker service create` — создание сервиса.
- `docker service update` — обновление сервиса.
- `docker service scale` — изменение числа реплик.
- `docker service ps` — просмотр задач (контейнеров) сервиса.

---

## 2. Практическая часть
### Создание и обновление сервиса
1. Инициализируйте режим Swarm, если он не активен:
    ```bash
    docker swarm init
    ```

2. Создайте сервис на основе образа `nginx`:
    ```bash
    docker service create --name web --replicas 3 -p 8080:80 nginx
    ```

3. Проверьте состояние сервиса:
    ```bash
    docker service ps web
    ```

4. Обновите сервис до новой версии образа:
    ```bash
    docker service update --image nginx:1.21 web
    ```

### Масштабирование сервисов
1. Увеличьте число реплик сервиса до 5:
    ```bash
    docker service scale web=5
    ```

2. Проверьте, что новые реплики запущены:
    ```bash
    docker service ps web
    ```

3. Уменьшите число реплик до 2:
    ```bash
    docker service scale web=2
    ```

### Настройка стратегии обновления
1. Обновите сервис с задержкой в 10 секунд между обновлениями задач:
    ```bash
    docker service update --update-parallelism 1 --update-delay 10s web
    ```

2. Наблюдайте за процессом обновления:
    ```bash
    docker service ps web
    ```

### Удаление сервиса
1. Удалите созданный сервис:
    ```bash
    docker service rm web
    ```

---

## 3. Теоретические вопросы
1. Что такое Docker Swarm, и в чем его назначение?
2. Как работает стратегия поэтапного обновления задач в Docker Swarm?
3. Чем отличается масштабирование сервиса от обновления сервиса?
4. Как проверить состояние всех задач сервиса?
5. Какие параметры влияют на поведение обновления сервиса?

---

## 4. Дополнительные задания
1. **Масштабирование нескольких сервисов:**
   - Создайте два сервиса и одновременно измените количество их реплик.

2. **Обновление с откатом:**
   - Настройте обновление сервиса с возможностью отката при ошибке.

3. **Проверка состояния задач:**
   - Проверьте статус всех задач сервиса и найдите причины их возможной остановки.

4. **Добавление узлов в кластер:**
   - Добавьте второй узел в кластер Swarm и протестируйте работу сервиса на нескольких узлах.

