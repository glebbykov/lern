
# Лабораторная работа №15
## Тема: Docker Compose

### Цель работы:
Изучить использование Docker Compose для управления многоконтейнерными приложениями и автоматизации процессов развертывания.

### Задачи:
1. Создать многоконтейнерное приложение с помощью Docker Compose.
2. Использовать volume для сохранения данных вне контейнера.
3. Организовать работу контейнеров в одной сети.
4. Добавить зависимости между контейнерами для последовательного запуска.
5. Автоматизировать процесс мониторинга состояния контейнеров.

### Оборудование и ПО:
- Установленный Docker и Docker Compose.
- Редактор текста для редактирования файлов `docker-compose.yml`.

### Теоретические вопросы:
1. Какие основные директивы используются в файле docker-compose.yml?
2. Как задать зависимости между контейнерами в Docker Compose?
3. Что такое volume и как его использовать для хранения данных?
4. Как сети Docker позволяют контейнерам взаимодействовать между собой?
5. Как Docker Compose управляет масштабированием контейнеров?

### Ход работы

#### 1. Создание многоконтейнерного приложения
**Задание:**  
Создать приложение, состоящее из двух контейнеров: NGINX и MySQL. Используйте Docker Compose для их запуска.

**Решение:**  
```yaml
version: '3'
services:
  web:
    image: nginx
    ports:
      - "8080:80"
    volumes:
      - web_data:/usr/share/nginx/html
    networks:
      - app_net
  db:
    image: mysql
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - app_net

volumes:
  web_data:
  db_data:

networks:
  app_net:
```

#### 2. Использование volumes для сохранения данных
**Задание:**  
Добавьте в Docker Compose volume для хранения данных базы данных MySQL, чтобы при перезапуске контейнера данные сохранялись.

**Решение:**  
Volume `db_data` в предыдущем примере используется для сохранения данных MySQL. Это позволяет данные из базы сохранять вне контейнера и делать их доступными при перезапуске.

#### 3. Организация работы контейнеров в одной сети
**Задание:**  
Создайте пользовательскую сеть в Docker Compose, чтобы контейнеры NGINX и MySQL могли взаимодействовать.

**Решение:**  
Используйте директиву `networks`, чтобы связать контейнеры через сеть `app_net`, как показано в предыдущем примере.

#### 4. Добавление зависимостей между контейнерами
**Задание:**  
Добавьте зависимости между контейнерами, чтобы контейнер с NGINX стартовал только после запуска контейнера MySQL.

**Решение:**  
```yaml
services:
  web:
    image: nginx
    depends_on:
      - db
```

#### 5. Автоматизация мониторинга состояния контейнеров
**Задание:**  
Создайте задачу в Ansible для автоматического мониторинга состояния контейнеров с помощью Docker Compose.

**Решение:**  
```yaml
- name: Monitor Docker containers
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Check status of containers
      shell: docker-compose ps
      register: container_status
    - name: Output container status
      debug:
        msg: "{{ container_status.stdout }}"
```

### Дополнительные задания:
1. **Масштабирование приложения:**  
Добавьте возможность масштабирования сервиса `web` в два контейнера и протестируйте работу с балансировкой нагрузки.

2. **Добавление резервного контейнера базы данных:**  
Создайте резервный контейнер базы данных и настройте репликацию между двумя контейнерами MySQL.

3. **Интеграция с Ansible:**  
Настройте Ansible-сценарий для автоматического развертывания и управления контейнерами с помощью Docker Compose на нескольких хостах.

4. **Настройка прокси-сервера:**  
Добавьте контейнер с HAProxy или Traefik в стек и настройте его для распределения запросов между несколькими NGINX-контейнерами.

### Вопросы для самопроверки:
1. Как работает директива `depends_on` в Docker Compose?
2. Какие способы масштабирования контейнеров предлагает Docker Compose?
3. Что происходит с данными, если не использовать volume для базы данных?
4. Как сети Docker Compose позволяют контейнерам находить друг друга?
5. Какие преимущества и недостатки использования Docker Compose по сравнению с Kubernetes?

### Заключение:
В ходе лабораторной работы были изучены принципы работы с Docker Compose для управления многоконтейнерными приложениями. Рассмотрены вопросы сохранения данных, сетевого взаимодействия контейнеров, управления зависимостями и автоматизации процессов с использованием Ansible.
