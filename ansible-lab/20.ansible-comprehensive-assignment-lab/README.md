
# Лабораторная работа №20: Комплексное задание на повторение тем Ansible и Molecule

## Цель работы:
Закрепить навыки разработки и тестирования ролей Ansible, освоить комплексное использование Molecule для тестирования ролей на различных платформах и с различными верификаторами.

## Задания:

### 1. Создание комплексной роли
1. Создайте новую роль `complex_role` для развёртывания веб-сервера (например, Nginx) и установки необходимых пакетов.
2. Добавьте в роль поддержку управления конфигурацией:
   - Настройте параметры веб-сервера, такие как порт, корневой каталог, логирование.
   - Убедитесь, что веб-сервер запускается при загрузке системы.
3. Включите в роль установку и настройку базы данных (например, MySQL или PostgreSQL) для хранения данных.

### 2. Настройка Molecule для многоуровневого тестирования
1. Создайте два сценария для Molecule:
   - `default`: Тестирование на системе Ubuntu.
   - `alternative`: Тестирование на CentOS.
2. В каждом сценарии настройте:
   - Проведение всех необходимых проверок: установка пакетов, проверка сервисов и сетевых подключений.
   - Запуск ролей с использованием Docker в качестве драйвера.

### 3. Использование различных верификаторов
1. В сценарии `default` настройте встроенный Ansible верификатор.
   - Создайте `verify.yml` и добавьте проверки, чтобы убедиться в успешной установке и работе веб-сервера и базы данных.
2. В сценарии `alternative` настройте верификатор Goss:
   - Проверьте наличие конфигурационных файлов, открытых портов, работающих сервисов и т. д.
3. Дополнительно создайте тесты с использованием TestInfra для обоих сценариев, чтобы проверить корректность настройки пользователей и прав доступа.

### 4. Конфигурация линтеров для роли
1. Настройте linters для роли `complex_role`, включая `yamllint`, `ansible-lint` и `ansible-later`.
2. Добавьте конфигурацию линтеров в `molecule.yml` и убедитесь, что роль проходит линтинг без ошибок.

### 5. Автоматизация тестирования в CI/CD (опционально)
1. Настройте автоматический запуск тестов Molecule при каждом изменении в репозитории.
2. Убедитесь, что Molecule запускает все сценарии и верификаторы для полного покрытия тестирования.

### 6. Дополнительные задания:
1. Добавьте опцию для установки и настройки кэш-сервера (например, Redis) в роли `complex_role`.
2. В сценарии `alternative` добавьте Goss-тесты для проверки состояния Redis.
3. Разработайте роли для установки и настройки дополнительных сервисов, таких как FTP-сервер или сервер мониторинга (например, Prometheus).

## Вопросы для закрепления:
1. Какие основные задачи выполняет Molecule при тестировании ролей Ansible?
2. Какие драйверы поддерживает Molecule, и в каких случаях стоит использовать Docker для тестирования?
3. Как Molecule помогает поддерживать идемпотентность ролей?
4. Какие верификаторы поддерживаются в Molecule и какие их преимущества?
5. Почему важно проводить статический анализ Ansible-кода, и какие инструменты для этого используются?
6. Как интегрировать Molecule с CI/CD и какие преимущества это даёт?
7. Какое значение имеет конфигурация линтеров в процессе разработки ролей?
8. Какие тесты лучше всего подходят для проверки работы веб-сервера? Приведите примеры.

