
# Лабораторная работа №18: Статический анализ Ansible кода

## Цель работы:
Познакомиться с инструментами статического анализа (линтерами) для проверки качества Ansible кода, такими как `yamllint`, `ansible-lint` и `ansible-later`, а также с их настройками и конфигурацией.

## Задания:

### 1. Установка и настройка линтеров
1. Установите `yamllint`, `ansible-lint` и `ansible-later` с помощью `pip`, если они не установлены.
   ```bash
   pip install yamllint ansible-lint ansible-later
   ```
2. Создайте конфигурационные файлы для каждого линтера в каталоге проекта.

### 2. Конфигурация `yamllint`
1. Создайте файл `.yamllint` и добавьте базовую конфигурацию (пример):
   ```yaml
   extends: default
   rules:
     braces:
       max-spaces-inside: 1
       level: error
     document-start: enable
     document-end: enable
     key-duplicates: enable
     line-length: disable
     new-line-at-end-of-file: enable
     new-lines:
       type: unix
     trailing-spaces: enable
     truthy: enable
   ```
2. Проверьте файл `my_playbook.yml` командой:
   ```bash
   yamllint my_playbook.yml
   ```

### 3. Конфигурация `ansible-lint`
1. Создайте файл `.ansible-lint` с конфигурацией, в которой укажите правила для исключения, если требуется:
   ```yaml
   skip_list:
     - yaml
   ```
2. Проверьте ваш плейбук командой:
   ```bash
   ansible-lint lintme.yml
   ```
3. Исправьте замечания, обнаруженные в процессе линтинга.

### 4. Конфигурация `ansible-later`
1. Создайте файл `.later.yml` с настройками для валидации Ansible плейбуков и ролей (пример):
   ```yaml
   ansible:
     custom_modules: []
     literal-bools:
       - "true"
       - "false"
   ```
2. Запустите `ansible-later`, чтобы проверить сценарии:
   ```bash
   ansible-later lint lintme.yml
   ```

### 5. Запуск всех линтеров с помощью Molecule
1. В файле `molecule/default/molecule.yml` добавьте команду для выполнения всех линтеров:
   ```yaml
   lint: |
     set -e
     yamllint .
     ansible-lint
     ansible-later
   ```
2. Запустите `molecule lint`, чтобы проверить роль или плейбук на наличие ошибок.

## Дополнительные задания:

### Дополнительное задание 1: Создание и использование профилей линтеров
1. Настройте конфигурацию для `yamllint` и `ansible-lint` для двух разных профилей: "строгий" и "основной".
2. Запустите каждый профиль по отдельности, используя команды для проверки с разными конфигурационными файлами.

### Дополнительное задание 2: Интеграция линтеров с CI/CD
1. Настройте запуск линтеров в файле конфигурации CI/CD (например, GitLab CI, GitHub Actions).
2. Убедитесь, что выполнение CI/CD останавливается при наличии ошибок, выявленных линтерами.

### Дополнительное задание 3: Создание собственных правил для `ansible-lint`
1. Создайте собственное правило для `ansible-lint`, чтобы проверять специфические для вашей роли требования.
2. Добавьте это правило в конфигурацию `ansible-lint` и проверьте выполнение на вашем плейбуке.

## Вопросы для закрепления:
1. Какие преимущества дает использование статического анализа для кода Ansible?
2. Какие проблемы могут быть обнаружены с помощью `yamllint`?
3. Как `ansible-lint` помогает улучшить код Ansible?
4. Почему важно проверять соответствие рекомендациям оформления кода?
5. Как интеграция линтеров в Molecule способствует улучшению процесса разработки?

