
# Лабораторная работа: Переменные и Факты в Ansible

## Цель:
Изучить использование переменных и фактов в Ansible, определить способы их применения в сценариях для автоматизации задач.

## Требования:
- Установленная Ansible на локальной или удалённой машине.
- Доступ к хостам для управления (локально или через SSH).

## Задание 1: Определение переменных в сценарии

1. Создайте плейбук `nginx_setup.yml`, который будет содержать переменные для установки и настройки Nginx.
2. Определите переменные в секции `vars`, как указано в примере:

```yaml
---
- name: Установка и настройка Nginx
  hosts: webservers
  become: true
  vars:
    tls_dir: /etc/nginx/ssl/
    key_file: nginx.key
    cert_file: nginx.crt
    conf_file: /etc/nginx/sites-available/default
    server_name: localhost
  tasks:
    - name: Установить Nginx
      package:
        name: nginx
        state: present
```

Запустите плейбук для установки Nginx на сервере с использованием определённых переменных.

## Задание 2: Вывод значений переменных

Добавьте задачу для вывода значений переменных с помощью модуля debug:

```yaml
    - name: Показать переменные
      debug:
        var: server_name
```

Убедитесь, что Ansible корректно выводит значение переменной server_name при выполнении плейбука.

## Задание 3: Использование файла для переменных

Перенесите переменные в отдельный файл `nginx_vars.yml`:

```yaml
tls_dir: /etc/nginx/ssl/
key_file: nginx.key
cert_file: nginx.crt
conf_file: /etc/nginx/sites-available/default
server_name: localhost
```

Измените плейбук для использования секции `vars_files`:

```yaml
vars_files:
  - nginx_vars.yml
```

Запустите плейбук и убедитесь, что он корректно использует переменные из файла.

## Задание 4: Регистрация переменных

Создайте плейбук `whoami.yml`, который выполнит команду `whoami` и сохранит результат в переменной:

```yaml
---
- name: Выполнить команду whoami
  hosts: localhost
  tasks:
    - name: Выполнить команду whoami
      command: whoami
      register: login

    - name: Показать результат
      debug:
        msg: "Пользователь: {{ login.stdout }}"
```

Запустите плейбук и проверьте, выводится ли правильное имя пользователя.

## Задание 5: Использование фактов

Создайте плейбук для вывода информации о системе (фактов), используя Ansible:

```yaml
---
- name: Получение фактов
  hosts: localhost
  gather_facts: true
  tasks:
    - name: Показать информацию об ОС
      debug:
        msg: "ОС: {{ ansible_facts['distribution'] }} {{ ansible_facts['distribution_version'] }}, Ядро: {{ ansible_facts['kernel'] }}"
```

Запустите плейбук и проанализируйте вывод фактов о системе.

## Задание 6: Локальные факты

На вашем управляемом хосте создайте директорию `/etc/ansible/facts.d/`. Создайте файл фактов `example.fact` в формате `.ini` со следующими данными:

```ini
[book]
title=Ansible: Up and Running
authors=Meijer, Hochstein, Moser
publisher=O'Reilly
```

Создайте плейбук для вывода локальных фактов:

```yaml
---
- name: Вывести локальные факты
  hosts: localhost
  tasks:
    - name: Показать локальные факты
      debug:
        var: ansible_local
```

Запустите плейбук и убедитесь, что локальные факты корректно выводятся.

## Дополнительные задания:

- Используйте переменную, переданную через командную строку при запуске плейбука. Например, установите переменную `greeting` и выведите её.
- Изучите модуль `set_fact` и используйте его для задания новой переменной в плейбуке.
- Исследуйте доступ к переменным на других хостах с использованием переменной `hostvars`.

## Вопросы для самопроверки:

1. Что такое факт в Ansible и как его можно использовать в плейбуках?
2. В чём отличие переменных, определённых в плейбуке, и фактов?
3. Как использовать файл для переменных и чем это удобно?
4. Какие существуют способы задания переменных в Ansible?
5. Что делает команда `ansible -m setup` и как можно использовать её результат?

## Заключение

В этой лабораторной работе вы изучили использование переменных и фактов в Ansible, а также научились работать с различными способами их задания и применения в плейбуках. Эти навыки помогут вам эффективнее автоматизировать задачи и управлять инфраструктурой с помощью Ansible.
