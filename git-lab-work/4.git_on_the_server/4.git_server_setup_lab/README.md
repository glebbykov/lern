
# Лабораторная работа 4: Настройка сервера Git

## Цель:
Научиться настраивать сервер Git с использованием SSH-доступа и ограничений для пользователей с помощью git-shell.

## Теоретическая часть:
Для безопасной работы с Git-сервером через SSH важно настроить доступ для пользователей, которые могут клонировать репозитории и отправлять изменения. В этой лабораторной работе вы научитесь создавать пользователя для Git и настраивать ограничения с помощью оболочки git-shell.

## Шаги для выполнения:

### Шаг 1: Создание пользователя Git
1. Создайте нового пользователя git:
   ```bash
   sudo adduser git
   ```

2. Настройте каталог `.ssh` для хранения открытых ключей:
   ```bash
   su git
   cd
   mkdir .ssh && chmod 700 .ssh
   touch .ssh/authorized_keys && chmod 600 .ssh/authorized_keys
   ```

### Шаг 2: Добавление открытых SSH-ключей пользователей
1. Скопируйте открытые ключи разработчиков в файл `authorized_keys`:
   ```bash
   cat /tmp/id_rsa.john.pub >> ~/.ssh/authorized_keys
   cat /tmp/id_rsa.josie.pub >> ~/.ssh/authorized_keys
   ```

### Шаг 3: Создание голого репозитория
1. Создайте новый голый репозиторий на сервере:
   ```bash
   cd /srv/git
   mkdir project.git
   cd project.git
   git init --bare
   ```

### Шаг 4: Настройка git-shell для ограничений
1. Убедитесь, что `git-shell` установлен на сервере:
   ```bash
   which git-shell
   ```

2. Если `git-shell` отсутствует в `/etc/shells`, добавьте её:
   ```bash
   sudo -e /etc/shells
   ```

3. Измените оболочку пользователя git на `git-shell`:
   ```bash
   sudo chsh git -s $(which git-shell)
   ```

4. Проверьте, что пользователь git не может получить доступ к обычной оболочке:
   ```bash
   ssh git@server
   ```

### Шаг 5: Ограничение функций SSH для пользователей
1. Ограничьте возможности перенаправления портов и других функций SSH, добавив параметры в файл `authorized_keys`:
   ```bash
   no-port-forwarding,no-X11-forwarding,no-agent-forwarding,no-pty ssh-rsa AAAAB3...
   ```

### Дополнительные задания:
1. Настройте git-shell для показа пользовательского сообщения при попытке входа в систему.
2. Создайте подкаталог для ограничения команд Git, которые пользователи могут выполнять.

## Вопросы для самопроверки:
1. Как настроить Git-сервер с использованием SSH и ограничить доступ к командной оболочке?
2. Что такое git-shell и какие преимущества она даёт при настройке сервера?
3. Как настроить ограничения для SSH-доступа с помощью файла authorized_keys?

## Ожидаемый результат:
- Вы должны научиться настраивать Git-сервер с использованием SSH, ограничивать доступ пользователей с помощью git-shell и управлять безопасностью доступа через SSH.
