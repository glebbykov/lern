
# Лабораторная работа №9: Резервное копирование и восстановление данных в Docker

## Цели работы
1. Научиться создавать резервные копии томов Docker.
2. Освоить восстановление данных из резервных копий.
3. Изучить экспорт и импорт контейнеров.
4. Понять разницу между сохранением состояния контейнера и данных.

---

## 1. Теоретическая часть
### Резервное копирование данных
- **Тома Docker:**
  - Используются для постоянного хранения данных контейнеров.
  - Команда `docker volume` для управления томами.

- **Создание резервной копии тома:**
  - Использование команды `tar` для архивации данных тома.

### Экспорт и импорт контейнеров
- **Экспорт контейнера:**
  - Команда `docker export` позволяет сохранить файловую систему контейнера в виде архива.
- **Импорт контейнера:**
  - Команда `docker import` используется для создания образа из архива.

### Восстановление данных
- Ручное восстановление данных из резервной копии.
- Восстановление томов и контейнеров с их данными.

---

## 2. Практическая часть
### Создание резервной копии тома
1. Создайте контейнер с подключенным томом:
    ```bash
    docker volume create app-data
    docker run -d --name app-container -v app-data:/data alpine sh -c "while true; do sleep 3600; done"
    ```

2. Скопируйте данные в том:
    ```bash
    docker exec app-container sh -c "echo 'Backup data' > /data/backup.txt"
    ```

3. Создайте резервную копию тома:
    ```bash
    docker run --rm -v app-data:/data -v $(pwd):/backup alpine tar czvf /backup/app-data-backup.tar.gz /data
    ```

### Восстановление тома из резервной копии
1. Удалите текущий том:
    ```bash
    docker volume rm app-data
    ```

2. Восстановите том из резервной копии:
    ```bash
    docker volume create app-data
    docker run --rm -v app-data:/data -v $(pwd):/backup alpine tar xzvf /backup/app-data-backup.tar.gz -C /
    ```

3. Проверьте, что данные восстановлены:
    ```bash
    docker run --rm -v app-data:/data alpine cat /data/backup.txt
    ```

### Экспорт и импорт контейнеров
1. Экспортируйте контейнер в архив:
    ```bash
    docker export app-container > app-container.tar
    ```

2. Импортируйте архив как новый образ:
    ```bash
    cat app-container.tar | docker import - restored-app
    ```

3. Запустите новый контейнер из импортированного образа:
    ```bash
    docker run -it restored-app sh
    ```

---

## 3. Теоретические вопросы
1. Что такое тома Docker и зачем они нужны?
2. В чем разница между командами `docker export` и `docker save`?
3. Какие данные сохраняются при создании резервной копии тома?
4. Как проверить состояние восстановленного тома или контейнера?
5. Почему важно использовать резервное копирование данных в контейнерах?

---

## 4. Дополнительные задания
1. **Автоматизация резервного копирования:**
   - Напишите скрипт для автоматического создания резервных копий томов.

2. **Резервное копирование нескольких томов:**
   - Создайте резервную копию нескольких томов и восстановите их.

3. **Проверка восстановления:**
   - Проверьте восстановление контейнера с данными и настройками.

4. **Шифрование данных резервной копии:**
   - Используйте `gpg` для шифрования резервной копии тома.

