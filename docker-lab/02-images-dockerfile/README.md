# 02. Images и Dockerfile

## Цель
Научиться собирать образ предсказуемо: быстрый билд, чистые слои, понятный runtime.

## Теория
- Основные инструкции: `FROM`, `WORKDIR`, `COPY`, `RUN`, `ENV`, `ARG`, `EXPOSE`, `CMD`, `ENTRYPOINT`.
- Кеш сборки зависит от порядка инструкций.
- Не храните секреты в `ARG`/`ENV` внутри Dockerfile.

## Практика
1. Соберите образ:
```bash
docker build -t dockerlab/simple-web:dev ./lab
```
2. Запустите контейнер:
```bash
docker run --rm -p 8090:8090 dockerlab/simple-web:dev
```
3. Проверьте приложение:
```bash
curl http://localhost:8090/healthz
```
4. Сравните с `broken/Dockerfile.bad` и объясните, почему он хуже.

## Проверка
- Образ собирается с кешем и запускается.
- Внутри контейнера процесс запускается от non-root пользователя.
- Понимаете разницу `CMD` и `ENTRYPOINT`.

## Типовые ошибки
- Слишком большой build context.
- Копирование всего проекта до установки зависимостей.
- Запуск приложения от root без необходимости.

## Вопросы
1. Как перестановка `COPY` влияет на скорость билда?
2. Почему `.dockerignore` обязателен?
3. Когда выбирать `ENTRYPOINT`, а когда `CMD`?

## Дополнительные задания
- Добавьте build-arg `APP_VERSION` и выводите его в `/healthz`.
- Сравните размер образа до и после оптимизаций.

## Файлы модуля
- `lab/` — рабочий Dockerfile и минимальное web-приложение.
- `broken/Dockerfile.bad` — анти-паттерны.
- `checks/verify.sh` — smoke-проверка образа.

## Cleanup
```bash
./cleanup.sh
```
