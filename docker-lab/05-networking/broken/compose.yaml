services:
  edge:
    image: nginx:1.27-alpine
    volumes:
      - ../lab/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
      - "8082:80"
    depends_on:
      - api
    networks:
      - frontend

  api:
    image: hashicorp/http-echo:1.0.0
    command: ["-text=api ok", "-listen=:5678"]
    expose:
      - "5678"
    # Broken: api is not in backend, cannot reach db there.
    networks:
      - frontend

  db:
    image: redis:7-alpine
    expose:
      - "6379"
    networks:
      - backend

networks:
  frontend:
  backend:
